# 互联网协议
参考原文：[互联网协议入门——阮一峰](http://www.ruanyifeng.com/blog/2012/05/internet_protocol_suite_part_i.html)

[toc]
## 一、概述
### 1.1 互联网的分层
- 应用层（application layer）
    - 传输层（Transport）
        - 网络层（network）
            - 连接层（Link）
                - 实体层（Physical）

越下面的层，越靠近硬件；
越上面的层，越靠近用户。

### 1.2 层与协议
层与层之间遵守的共同规则叫：协议

## 二、实体层
"实体层“就是把电脑连接起来的物理手段。它主要规定了网络的一些电气特性，作用是负责传送0和1的电信号。

## 三、链接层
### 3.1 定义
链接层的功能，它在"实体层"的上方，确定了0和1的分组方式。即，解决了：解读方式的问题，多少个电信号算一组？每个信号位有何意义？

### 3.2 以太网协议
以太网规定，一组电信号构成一个数据包，叫做”帧“，每一帧分成两部分：
- 标头（Head）
    - 包含数据包的一些说明项，比如发送者、接收者、数据类型等等；
    - 长度固定为18字节
- 数据（Data）
    - 最短为 46 歌字节，最长为 1500 字节

如果数据很长，就必须分割成多个帧发送

### 3.3 MAC地址
以太网规定，连入网络的所有设备，都必须具有”网卡“接口。数据包必须是从一块网卡，传送到另一块网卡。

网卡的地址就是数据包的发送地址和接收地址，这就叫做 MAC 地址

每块网卡出厂时，都有一个全世界独一无二的 MAC 地址，长度时 48 个二进制，通常用 12 个十六进制数表示，前 6 个十六进制数是厂商编号，后 6 个是该厂商的网卡流水号

### 3.4 广播
以太网采用了一种很"原始"的方式，它不是把数据包准确送到接收方，而是向本网络内所有计算机发送，让每台计算机自己判断，是否为接收方。

## 四、网络层
### 4.1 由来
互联网是无数子网络共同组成的一个巨型网络。为了使不同子网络的计算机之间可以进行通话，就必须找到一种方法，用来区分哪些 MAC 地址属于同一个子网络，哪些不是。

如果同一个子网络，就采用广播方式发送，否则采用”路由“的方式发送（"路由"的意思，就是指如何向不同的子网络分发数据包）

然而 MAC 地址本身无法做到这一点，只与厂商有关，与所处网络无关。

**这就导致了”网络层“的诞生**

它的作用就是引进一套新的地址，使我们能够区分不同计算机是否属于同一个子网络，这套地址叫做”网络地址“，即：网址

MAC 地址与网络地址，二者没有任何关系，二者只是随记的组合在一起。
- MAC 地址是绑定在网卡上的
- 网络地址是管理员分配的

网络地址帮助我们确定计算机属于哪一个计算机网络，而 MAC 地址则将数据包送到该子网络的目标计算机中（目标网卡），即，先处理网络地址，再处理 MAC 地址。

### 4.2 IP协议
规定网络地址的协议，叫做IP协议， ipv4，ipv6

互联网上的每一台计算机，都会分配到一个IP地址。这个地址分成两个部分，前一部分代表网络，后一部分代表主机。

同时，还可以使用“子网掩码”来判断任意两个 IP 地址 是否处于同一个子网络

方法是将两个IP地址与子网掩码分别进行AND运算（两个数位都为1，运算结果为1，否则为0），然后比较结果是否相同，如果是的话，就表明它们在同一个子网络中，否则就不是。

### 4.3 IP数据包
根据IP协议发送的数据，就叫做IP数据包

我们可以把IP数据包直接放进以太网数据包的"数据"部分，因此完全不用修改以太网的规格。这就是互联网分层结构的好处：上层的变动完全不涉及下层的结构。

![](_v_images/_1527231894_5163.png)

IP数据包的"标头"部分的长度为20到60字节，整个数据包的总长度最大为65,535字节。因此，理论上，一个IP数据包的"数据"部分，最长为65,515字节。前面说过，以太网数据包的"数据"部分，最长只有1500字节。因此，如果IP数据包超过了1500字节，它就需要分割成几个以太网数据包，分开发送了。

### 4.4 ARP协议
IP 地址和 MAC 地址必须都要知道，而通常情况下，IP 地址是已知的，因此，我们需要一种机制，能够从 IP 地址得到 MAC 地址。

分两种不同的情况
1. 如果两台主机不在同一个子网络，那么事实上没有办法得到对方的MAC地址，只能把数据包传送到两个子网络连接处的"网关"（gateway），让网关去处理。
2. 












